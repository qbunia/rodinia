#include "rex_kmp.h" 
char OUT__1__6171__kernel_cpu__70__id__ = 0;
struct __tgt_offload_entry OUT__1__6171__kernel_cpu__70__omp_offload_entry__ __attribute__((section("omp_offloading_entries")))  = {((void *)(&OUT__1__6171__kernel_cpu__70__id__)), "OUT__1__6171__kernel_cpu__70__kernel__", 0, 0, 0};
//========================================================================================================================================================================================================200
//	DEFINE/INCLUDE
//========================================================================================================================================================================================================200
#define NUM_TEAMS 256
#define NUM_THREADS 1024
//======================================================================================================================================================150
//	LIBRARIES
//======================================================================================================================================================150
#include <omp.h>   // (in directory known to compiler)			needed by openmp
#include <stdio.h> // (in directory known to compiler)			needed by printf, stderr
#include <stdlib.h> // (in directory known to compiler)			needed by malloc
//======================================================================================================================================================150
//	COMMON
//======================================================================================================================================================150
#include "../common.h" // (in directory provided here)
//======================================================================================================================================================150
//	UTILITIES
//======================================================================================================================================================150
#include "../util/timer/timer.h" // (in directory provided here)
//========================================================================================================================================================================================================200
//	KERNEL_CPU FUNCTION
//========================================================================================================================================================================================================200

void kernel_cpu(int cores_arg,record *records,knode *knodes,long knodes_elem,int order,long maxheight,int count,long *currKnode,long *offset,int *keys,record *ans)
{
//======================================================================================================================================================150
//	Variables
//======================================================================================================================================================150
// timer
  long long time0;
  long long time1;
  long long time2;
  time0 = get_time();
//======================================================================================================================================================150
//	MCPU SETUP
//======================================================================================================================================================150
  int threadsPerBlock;
  threadsPerBlock = (order < 1024?order : 1024);
  time1 = get_time();
//======================================================================================================================================================150
//	PROCESS INTERACTIONS
//======================================================================================================================================================150
// private thread IDs
  int thid;
  int bid;
  int i;
{
/* Launch CUDA kernel ... */
    int64_t __device_id = 0;
    int _threads_per_block_ = 1024;
    int _num_blocks_ = 256;
    void *__host_ptr = (void *)(&OUT__1__6171__kernel_cpu__70__id__);
    void *__args_base[] = {records, &knodes_elem, &maxheight, &count, &threadsPerBlock, knodes, currKnode, offset, keys, ans};
    void *__args[] = {records, &knodes_elem, &maxheight, &count, &threadsPerBlock, knodes + 0, currKnode + 0, offset + 0, keys + 0, ans + 0};
    int64_t __arg_sizes[] = {((int64_t )(sizeof(record *))), ((int64_t )(sizeof(long ))), ((int64_t )(sizeof(long ))), ((int64_t )(sizeof(int ))), ((int64_t )(sizeof(int ))), ((int64_t )(sizeof(struct knode ) * knodes_elem)), ((int64_t )(sizeof(long ) * count)), ((int64_t )(sizeof(long ) * count)), ((int64_t )(sizeof(int ) * count)), ((int64_t )(sizeof(struct record ) * count))};
    int64_t __arg_types[] = {33, 33, 33, 33, 33, 33, 33, 33, 33, 35};
    int32_t __arg_num = 10;
    __tgt_target_teams(__device_id,__host_ptr,__arg_num,__args_base,__args,__arg_sizes,__arg_types,_num_blocks_,_threads_per_block_);
  }
  time2 = get_time();
//======================================================================================================================================================150
//	DISPLAY TIMING
//======================================================================================================================================================150
  printf("Time spent in different stages of CPU/MCPU KERNEL:\n");
  printf("%15.12f s, %15.12f %% : MCPU: SET DEVICE\n",(((float )(time1 - time0)) / 1000000),(((float )(time1 - time0)) / ((float )(time2 - time0)) * 100));
  printf("%15.12f s, %15.12f %% : CPU/MCPU: KERNEL\n",(((float )(time2 - time1)) / 1000000),(((float )(time2 - time1)) / ((float )(time2 - time0)) * 100));
  printf("Total time:\n");
  printf("%.12f s\n",(((float )(time2 - time0)) / 1000000));
}
